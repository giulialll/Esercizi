Ci sono alcune duplicazioni che potresti risolvere e alcune funzioni che potresti astrarre per aumentare la leggibilit√† del codice.